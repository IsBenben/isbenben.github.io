<!DOCTYPE html>
<html lang="zh-CN"> <head> <meta charset="UTF-8" /> <title>Scratch支持UTF-16 - Benben's Blog</title> <link rel="stylesheet" href="/index.css" /> <script defer src="/index.js"></script> <meta name="description" content="Scratch将UTF-16错误地由UCS-2读取。 而Scratch不支持直接获取包含特殊表情字符的长度，或某个字符。 本示例展示如何手动处理字符串，解决该问题。"> <script defer src="https://cloud.umami.is/script.js" data-website-id="cae6367e-6ca5-4b1e-893e-96c54137a755"></script> </head> <body> <div class="container"> <div class="title-area"> <h1><span>Benben's Blog</span></h1> <nav class="links"> <a href="/" class="return">返回首页</a> </nav> </div> <div class="contents clearfix"> <aside><div class="aside-item"> <h2>文章信息</h2> <div class="metadata-line"><span class="iconfont icon-date">发布日期：2025/2/17</span></div>
<div class="metadata-line"><a class="tag iconfont icon-tag-lang" style="--tag-width: 5.8" title="语言标签 - 项目主要使用的编程语言&#10;项目主要使用Scratch3或衍生编辑器（如TurboWarp）进行图形化编程。" href="/tags/lang-scratch3.html" >Scratch3</a
>
<a class="tag iconfont icon-tag-inspiration" style="--tag-width: 3" title="灵感标签 - 项目创意来源&#10;项目从概念设计到实现均为独立创作，未直接借鉴现有项目。" href="/tags/inspiration-original.html" >原创</a
>
<a class="tag iconfont icon-tag-content" style="--tag-width: 3" title="内容标签 - 项目主要内容&#10;项目侧重于知识分享、学习工具或互动式学习体验。" href="/tags/content-learning.html" >学习</a
>
</div>
</div><div class="aside-item"> <h2>相关链接</h2> <ul><li><a href="https://github.com/IsBenben/Funny-Things/blob/main/UTF-16支持.sb3">查看示例程序</a></li><li><a href="https://www.bilibili.com/video/BV1iawdejEnG">演示视频</a></li></ul>
</div><div class="aside-item"> <h2>快捷下载</h2> <ul><li><a download href="/raw/utf-16-supporting.sb3" title="将下载为：utf-16-supporting.sb3">下载示例程序</a></li></ul>
</div></aside> <article> <h1>Scratch支持UTF-16</h1>
<h2>复现过程</h2>
<pre><code class="language-plain">😊😇🥰😍🤩
</code></pre>
<p>如该表情字符串。如果使用基本的字符串转列表，会将这些表情符号转换成乱码。</p>
<h2>问题原因</h2>
<p>这主要是因为 <code>UTF-16</code> 字符串错误地被 <code>UCS-2</code> 读取。</p>
<ul>
<li>UTF-16是一个<strong>变长表示</strong>，一个Unicode字符可能由1个或2个16位长的码元表示。2个16位长的码元被称为一个代理对，第一个码元为UTF-16标志位。</li>
<li>UCS-2是一个<strong>固定表示</strong>，每个Unicode字符由2个字节表示。
则UTF-16中由2个16位长的码元表示的字符，在UCS-2中读取会变成两个乱码字符。</li>
</ul>
<h2>解决方法</h2>
<p>手动处理字符串。当遇到UTF-16标志位，将两个码元合并为一个字符加入列表，否则直接将一个码元加入列表。然后列表中就是正确的字符列表。这样可以通过列表实现正确的字符操作，并同时支持UTF-16中用一个码元表示的字符和代理对。</p> </article> </div> </div> </body>
</html>
